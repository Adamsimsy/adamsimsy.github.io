---
layout: default
---

<article class="post">
  <!-- Table of Contents -->
  <nav class="post-toc" id="post-toc">
    <div class="toc-header">
      <h3>Contents</h3>
      <button class="toc-toggle" id="toc-toggle" aria-label="Toggle table of contents">
        <span class="toc-toggle-icon">−</span>
      </button>
    </div>
    <ul class="toc-list" id="toc-list">
      <!-- TOC items will be generated by JavaScript -->
    </ul>
  </nav>

  <div class="post-container">
    <header class="post-header">
      <div class="post-meta-info">
        <time class="post-date" datetime="{{ page.date | date_to_xmlschema }}">
          {%- assign date_format = site.adamtheme.date_format | default: "%b %-d, %Y" -%}
          {{ page.date | date: date_format }}
        </time>
        {%- if page.author -%}
          <span class="post-author">by {{ page.author }}</span>
        {%- endif -%}
      </div>
      <h1 class="post-title">{{ page.title | escape }}</h1>
    </header>

    <div class="post-content">
      {{ content }}
    </div>

    </footer>
  </div>

  {%- if site.disqus.shortname -%}
    {%- include disqus_comments.html -%}
  {%- endif -%}
</article>

<!-- Post Navigation Cards - Completely outside article element -->
{%- if page.previous or page.next -%}
  <div class="post-navigation">
    <div class="nav-cards">
      {%- if page.previous -%}
        <div class="nav-card nav-prev">
          <a href="{{ page.previous.url | relative_url }}">
            {%- if page.previous.thumbnail -%}
              <div class="nav-card-image">
                <img src="{{ page.previous.thumbnail | relative_url }}" alt="{{ page.previous.title | escape }}" />
              </div>
            {%- else -%}
              <div class="nav-card-image">
                <img src="/images/code.svg" alt="{{ page.previous.title | escape }}" />
              </div>
            {%- endif -%}
            <div class="nav-card-content">
              <span class="nav-card-label">Previous</span>
              <h3 class="nav-card-title">{{ page.previous.title | escape }}</h3>
            </div>
          </a>
        </div>
      {%- else -%}
        <div class="nav-card nav-spacer"></div>
      {%- endif -%}
      
      {%- if page.next -%}
        <div class="nav-card nav-next">
          <a href="{{ page.next.url | relative_url }}">
            {%- if page.next.thumbnail -%}
              <div class="nav-card-image">
                <img src="{{ page.next.thumbnail | relative_url }}" alt="{{ page.next.title | escape }}" />
              </div>
            {%- else -%}
              <div class="nav-card-image">
                <img src="/images/code.svg" alt="{{ page.next.title | escape }}" />
              </div>
            {%- endif -%}
            <div class="nav-card-content">
              <span class="nav-card-label">Next</span>
              <h3 class="nav-card-title">{{ page.next.title | escape }}</h3>
            </div>
          </a>
        </div>
      {%- else -%}
        <div class="nav-card nav-spacer"></div>
      {%- endif -%}
    </div>
  </div>
{%- endif -%}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tocContainer = document.getElementById('post-toc');
  const tocList = document.getElementById('toc-list');
  const tocToggle = document.getElementById('toc-toggle');
  const tocToggleIcon = tocToggle.querySelector('.toc-toggle-icon');
  const postContent = document.querySelector('.post-content');
  
  if (!postContent) return;
  
  // Generate TOC from H2 and H3 headings
  const headings = postContent.querySelectorAll('h2, h3');
  
  if (headings.length === 0) {
    tocContainer.style.display = 'none';
    return;
  }
  
  // Helper function to create a URL-friendly ID
  function createId(text) {
    return text.toLowerCase()
      .replace(/[^\w\s-]/g, '') // Remove special characters
      .replace(/\s+/g, '-')     // Replace spaces with hyphens
      .replace(/-+/g, '-')      // Replace multiple hyphens with single
      .trim();
  }
  
  let h2Counter = 0;
  let h3Counter = 0;
  
  headings.forEach((heading, index) => {
    const isH2 = heading.tagName.toLowerCase() === 'h2';
    const isH3 = heading.tagName.toLowerCase() === 'h3';
    
    // Reset H3 counter when we encounter a new H2
    if (isH2) {
      h2Counter++;
      h3Counter = 0;
    } else if (isH3) {
      h3Counter++;
    }
    
    // Create an ID for the heading if it doesn't have one
    if (!heading.id) {
      const baseId = createId(heading.textContent) || 'heading-' + index;
      let finalId = baseId;
      let counter = 1;
      
      // Ensure unique IDs
      while (document.getElementById(finalId)) {
        finalId = baseId + '-' + counter;
        counter++;
      }
      
      heading.id = finalId;
    }
    
    // Create TOC item
    const tocItem = document.createElement('li');
    const tocLink = document.createElement('a');
    tocLink.href = '#' + heading.id;
    
    // Generate appropriate numbering
    let numberText = '';
    if (isH2) {
      numberText = `${h2Counter}.`;
    } else if (isH3) {
      // If H3 appears without a preceding H2, treat it as a top-level item
      if (h2Counter === 0) {
        h2Counter = 1;
        h3Counter = 1;
        numberText = `${h3Counter}.`;
      } else {
        numberText = `${h2Counter}.${h3Counter}`;
      }
    }
    
    tocLink.innerHTML = `<span class="toc-number">${numberText}</span> ${heading.textContent}`;
    tocLink.className = `toc-link ${isH2 ? 'toc-h2' : 'toc-h3'}`;
    tocLink.title = heading.textContent; // Add tooltip
    tocItem.appendChild(tocLink);
    tocList.appendChild(tocItem);
    
    // Smooth scroll behavior
    tocLink.addEventListener('click', function(e) {
      e.preventDefault();
      const targetPosition = heading.getBoundingClientRect().top + window.pageYOffset - 80; // Account for sticky header
      window.scrollTo({ 
        top: targetPosition,
        behavior: 'smooth'
      });
      
      // Update URL without triggering scroll
      if (history.replaceState) {
        history.replaceState(null, null, '#' + heading.id);
      }
    });
  });
  
  // Toggle TOC visibility
  let isCollapsed = localStorage.getItem('toc-collapsed') === 'true';
  if (isCollapsed) {
    tocList.style.display = 'none';
    tocToggleIcon.textContent = '+';
    tocContainer.classList.add('collapsed');
  }
  
  tocToggle.addEventListener('click', function() {
    isCollapsed = !isCollapsed;
    tocList.style.display = isCollapsed ? 'none' : 'block';
    tocToggleIcon.textContent = isCollapsed ? '+' : '−';
    tocContainer.classList.toggle('collapsed', isCollapsed);
    localStorage.setItem('toc-collapsed', isCollapsed);
  });
  
  // Highlight active section on scroll
  function highlightActiveSection() {
    let current = '';
    const scrollPosition = window.scrollY + 100; // Account for sticky header
    
    headings.forEach(heading => {
      const rect = heading.getBoundingClientRect();
      const headingTop = rect.top + window.pageYOffset;
      
      if (scrollPosition >= headingTop) {
        current = heading.id;
      }
    });
    
    // Remove active class from all links
    tocList.querySelectorAll('.toc-link').forEach(link => {
      link.classList.remove('active');
    });
    
    // Add active class to current link
    if (current) {
      const activeLink = tocList.querySelector(`a[href="#${current}"]`);
      if (activeLink) {
        activeLink.classList.add('active');
        
        // Scroll the active item into view within the TOC
        const linkRect = activeLink.getBoundingClientRect();
        const tocRect = tocList.getBoundingClientRect();
        
        if (linkRect.top < tocRect.top || linkRect.bottom > tocRect.bottom) {
          activeLink.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center',
            inline: 'nearest'
          });
        }
      }
    }
  }
  
  // Throttled scroll handler
  let scrollTimeout;
  window.addEventListener('scroll', function() {
    if (scrollTimeout) {
      clearTimeout(scrollTimeout);
    }
    scrollTimeout = setTimeout(highlightActiveSection, 10);
  });
  
  // Handle hash navigation on page load
  if (window.location.hash) {
    setTimeout(() => {
      const target = document.querySelector(window.location.hash);
      if (target) {
        const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - 80;
        window.scrollTo({ 
          top: targetPosition,
          behavior: 'smooth'
        });
      }
    }, 100);
  }
  
  // Initial highlight
  highlightActiveSection();
});
</script>
